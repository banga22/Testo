const { Telegraf, Markup } = require('telegraf');
const bot = new Telegraf('7871514395:AAEKXYC0n8rbfPaWmIuYjstEkf7psDgN1tQ'); // –í–∞—à —Ç–æ–∫–µ–Ω

// 1. –ö–æ–º–∞–Ω–¥–∞ /start - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
bot.command('start', (ctx) => {
    const welcomeText = `üëã –ü—Ä–∏–≤–µ—Ç, ${ctx.from.first_name}! –Ø –±–æ—Ç —Å–µ—Ä–≤–∏—Å–∞ 3D-—É—Å–ª—É–≥.\n\n` +
        `‚ú® *–ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å:*\n` +
        `- üõ†Ô∏è –ù–∞–π—Ç–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –¥–ª—è –≤–∞—à–µ–≥–æ 3D –ø—Ä–æ–µ–∫—Ç–∞\n` +
        `- üìù –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ —É–¥–æ–±–Ω—É—é —Ñ–æ—Ä–º—É\n` +
        `- üìû –°–≤—è–∑–∞—Ç—å –≤–∞—Å –Ω–∞–ø—Ä—è–º—É—é —Å –º–∞—Å—Ç–µ—Ä–æ–º\n\n` +
        `üìå *–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:*\n` +
        `1. –í—ã–±–∏—Ä–∞–µ—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞\n` +
        `2. –ó–∞–ø–æ–ª–Ω—è–µ—Ç–µ —Ñ–æ—Ä–º—É —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–¥–∞—á–∏\n` +
        `3. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ Telegram\n\n` +
        `üöÄ –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /order –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ!`;

    ctx.replyWithMarkdown(welcomeText, {
        reply_markup: {
            inline_keyboard: [
                [Markup.button.webApp('üìù –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –∑–∞–∫–∞–∑–∞', 'https://banga22.github.io/Testo/')],
                [Markup.button.callback('üë®‚Äçüé® –°–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π', 'show_executors')]
            ]
        }
    });
});

// 2. –ö–æ–º–∞–Ω–¥–∞ /order - –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
bot.command('order', (ctx) => {
    ctx.reply('üìù –î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:', {
        reply_markup: {
            inline_keyboard: [
                [Markup.button.webApp('üìù –û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –∑–∞–∫–∞–∑–∞', 'https://banga22.github.io/Testo/')]
            ]
        }
    });
});

// 3. –ö–æ–º–∞–Ω–¥–∞ /help - –ø–æ–º–æ—â—å
bot.command('help', (ctx) => {
    const helpText = `‚ÑπÔ∏è *–ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É*\n\n` +
        `/start - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º\n` +
        `/order - –û—Ñ–æ—Ä–º–∏—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑\n` +
        `/help - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å\n` +
        `/executors - –°–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π\n\n` +
        `‚ùì *–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã:*\n` +
        `- –§–æ—Ä–º–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è? –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É\n` +
        `- –ù–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ? –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∞–º\n` +
        `- –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞: @support_username`;
    
    ctx.replyWithMarkdown(helpText);
});

// 4. –ö–æ–º–∞–Ω–¥–∞ /executors - —Å–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
bot.command('executors', (ctx) => {
    const executorsText = `üë®‚Äçüé® *–ù–∞—à–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏*\n\n` +
        `1. –ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤ - 3D –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ\n` +
        `   ‚Ä¢ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è\n` +
        `   ‚Ä¢ –†–µ–π—Ç–∏–Ω–≥: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê\n\n` +
        `2. –ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞ - –¢–µ–∫—Å—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ\n` +
        `   ‚Ä¢ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: PBR –º–∞—Ç–µ—Ä–∏–∞–ª—ã\n` +
        `   ‚Ä¢ –†–µ–π—Ç–∏–Ω–≥: ‚≠ê‚≠ê‚≠ê‚≠ê\n\n` +
        `3. –î–º–∏—Ç—Ä–∏–π –°–∏–¥–æ—Ä–æ–≤ - –†–µ—Ç–æ–ø–æ–ª–æ–≥–∏—è\n` +
        `   ‚Ä¢ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –∏–≥—Ä–æ–≤—ã–µ –º–æ–¥–µ–ª–∏\n` +
        `   ‚Ä¢ –†–µ–π—Ç–∏–Ω–≥: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê\n\n` +
        `–î–ª—è –≤—ã–±–æ—Ä–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /order`;
    
    ctx.replyWithMarkdown(executorsText);
});

// 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ callback-–∫–Ω–æ–ø–æ–∫
bot.action('show_executors', (ctx) => {
    ctx.answerCbQuery();
    ctx.replyWithMarkdown(`–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π:`, {
        reply_markup: {
            inline_keyboard: [
                [
                    Markup.button.callback('3D –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ', 'category_modeling'),
                    Markup.button.callback('–¢–µ–∫—Å—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ', 'category_texturing')
                ],
                [
                    Markup.button.callback('–ê–Ω–∏–º–∞—Ü–∏—è', 'category_animation'),
                    Markup.button.callback('–†–µ—Ç–æ–ø–æ–ª–æ–≥–∏—è', 'category_retopology')
                ],
                [Markup.button.webApp('–í—Å–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏', 'https://banga22.github.io/Testo/executors.html')]
            ]
        }
    });
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
bot.action(/category_/, (ctx) => {
    const category = ctx.match[0].split('_')[1];
    const categories = {
        modeling: '3D –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ',
        texturing: '–¢–µ–∫—Å—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ',
        animation: '–ê–Ω–∏–º–∞—Ü–∏—è',
        retopology: '–†–µ—Ç–æ–ø–æ–ª–æ–≥–∏—è'
    };
    
    ctx.answerCbQuery(`–í—ã –≤—ã–±—Ä–∞–ª–∏: ${categories[category]}`);
    ctx.reply(`–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${categories[category]}":\n\n` +
        `1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å 1\n` +
        `2. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å 2\n` +
        `3. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å 3\n\n` +
        `–î–ª—è –∑–∞–∫–∞–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /order`);
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
bot.on('text', (ctx) => {
    ctx.replyWithMarkdown(`–Ø –Ω–µ –ø–æ–Ω–∏–º–∞—é —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã:\n` +
        `/start - –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É\n` +
        `/help - –ø–æ–º–æ—â—å\n` +
        `/order - –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑`);
});

// –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
bot.launch()
    .then(() => console.log('–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!'))
    .catch(err => console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞:', err));

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ–Ω—é –±–æ—Ç–∞
bot.telegram.setMyCommands([
    { command: 'start', description: '–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞' },
    { command: 'order', description: '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑' },
    { command: 'executors', description: '–°–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π' },
    { command: 'help', description: '–ü–æ–º–æ—â—å' }
]);

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é
bot.telegram.setChatMenuButton({
    menu_button: {
        type: 'web_app',
        text: 'üìù –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞',
        web_app: { url: 'https://banga22.github.io/Testo/' }
    }
});
